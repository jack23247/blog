---
title: "Getting NVIDIA Visual Profiler running in 2024"
date: 2024-01-21T14:22:00+01:00
categories:
 - linux
tags:
 - cuda
 - nvidia
 - university
 - linux
 - legacy
---

NVIDIA Visual Profiler has been discontinued in favor of the NSight Compute suite, which [does not support older GPUs](https://stackoverflow.com/questions/69599572/nsight-compute-says-profiling-is-not-supported-on-this-device-why) (_[so... NVIDIA, f-u!](https://www.youtube.com/watch?v=_36yNWw_07g)_). Having to use a venerable, but still viable [GTX 1050](https://www.techpowerup.com/gpu-specs/geforce-gtx-1050.c2875) for a course, I had to try and get the older Visual Profiler up and running.

## NVIDIA Visual Profiler

NVIDIA Visual Profiler (NVVP) is a GUI application written in Java[^1] that can be used to perform automated analysis of performance data exported by the `nvprof` tool.

[^1]: It's the $n$-th commercial tool based on that steaming pile of garbage we call Eclipse, FYI.

<img src="https://raw.githubusercontent.com/jack23247/blog/master/img/nvvp.png" alt="nvvp-splash" style="height: 15em;" />

_Nothing screams «corporate software» like a good splash screen!_

NVIDIA still hosts the [NVVP homepage](https://developer.nvidia.com/nvidia-visual-profiler), but the tool has been discontinued.

Here's an overview of what you can do with `nvprof` (and, by extension, NVVP): [CUDA Pro Tip: nvprof is Your Handy Universal GPU Profiler](https://developer.nvidia.com/blog/cuda-pro-tip-nvprof-your-handy-universal-gpu-profiler/).

## Getting `nvprof` running

The `nvprof` tool is part of the CUDA toolkit. I have been given access (thanks, EmaPe) to a server where the latest version of the CUDA toolkit had already been installed. 

To get it working, I had to ask an administrator to follow [this procedure](https://developer.nvidia.com/nvidia-development-tools-solutions-err_nvgpuctrperm-permission-issue-performance-counters), as I didn't have the right permissions to access the GPU's performance counters.

Here's what `nvprof` reports:

```
remote$ nvprof -V
nvprof: NVIDIA (R) Cuda command line profiler
Copyright (c) 2012 - 2023 NVIDIA Corporation
Release version 12.3.101 (21)
```

## Getting NVVP running

I tried running NVVP directly on the remote host with `ssh -X`, but it failed due to a Java error I later learned to be caused by the fact that NVVP won't run on a JDK newer than 1.8.0.

This left me with the necessity to install NVVP locally, which meant locating the appropriate packages.

### The Ubuntu route

Apparently, NVVP [is still provided by Ubuntu in their repositories](https://packages.ubuntu.com/search?keywords=nvidia-visual-profiler). Since I have an Ubuntu VM lying around, I decided to give it a try.

I was able to get NVVP running but it turns out it's never been updated to the latest version, so it can't import the capture files generated by my version of `nvprof`.

### Installing on Fedora 38

By pure luck I stumbled across the old NVIDIA CUDA toolkit repository, from where I was able to download the appropriate version of the packages for my system.

1. Write down the `nvprof` version, this will be necessary to download the correct packages. In my case, this is `12.3.101`.
2. Navigate to [https://developer.download.nvidia.com/compute/cuda/repos/fedora37/x86_64/](https://developer.download.nvidia.com/compute/cuda/repos/fedora37/x86_64/). This will differ if you use another distro.
3. Download the appropriate version of the following packages:
   - `cuda-nvprof`
   - `cuda-nvvp`
   - `cuda-nvdisasm`
   - `cuda-cupti`
4. Install all of the above. I decided to ignore dependencies, as NVVP depends on Java 1.7.0 and I won't be installing it anyway.
   - `rpm -ivh --nodeps cuda-*.rpm`
5. Install Java 8 with `dnf install -y java-1.8.0-openjdk`, then use `alternatives --config java` to select Java 1.8.0 as the default JRE.
6. Run `/usr/local/cuda-12.3/bin/nvvp`.
7. Profit.

Now you should be able to import files generated by `nvprof` without NVVP complaining about a version mismatch!

## Using NVVP

NVVP can bse used to profile a program directly or to interactively analyze performance data captured by `nvprof`.

### Remote connection

Technically, a local installation of NVVP [should be able to connect to a remote host](https://docs.nvidia.com/cuda/profiler-users-guide/index.html#remote-profiling-with-visual-profiler), but I wasn't able to get it working (I guess due to an outdated ssh client cipher).

### `nvprof` files

`nvprof` can be used from the command line to generate performance data capture files that can be imported and analyzed by NVVP. In order to do so, you must use the correct `nvprof` options. I did the following:

```
remote$ nvprof -f --analysis-metrics --export-profile capture.nvprof ./my_cuda_app
```

The `-f` flag allows you to overwrite existing capture files, while the `--analysis-metrics` option is used to generate a file that contains all of the metrics necessary for guided analysis.

Once the file has been generated, you can copy it to your machine and import it into NVVP, then start analyzing it.
